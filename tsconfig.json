{
  "result": [
    {
      "id": "copilotiq/tokens.rego",
      "raw": "# Authorization Policy for API Token Generation and Refresh\n# Created M. Massenzio, 2022-06-07\n\npackage copilotiq\nimport data.copilotiq.common as c\n\n# Users are allowed to request their tokens to be refreshed.\nallow {\n    c.is_user\n    input.resource.method == \"GET\"\n    c.entity = \"token\"\n}\n",
      "ast": {
        "package": {
          "path": [
            {
              "type": "var",
              "value": "data"
            },
            {
              "type": "string",
              "value": "copilotiq"
            }
          ]
        },
        "rules": [
          {
            "head": {
              "name": "allow",
              "value": {
                "type": "boolean",
                "value": true
              },
              "ref": [
                {
                  "type": "var",
                  "value": "allow"
                }
              ]
            },
            "body": [
              {
                "terms": {
                  "type": "ref",
                  "value": [
                    {
                      "type": "var",
                      "value": "data"
                    },
                    {
                      "type": "string",
                      "value": "copilotiq"
                    },
                    {
                      "type": "string",
                      "value": "common"
                    },
                    {
                      "type": "string",
                      "value": "is_user"
                    }
                  ]
                },
                "index": 0
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "input"
                      },
                      {
                        "type": "string",
                        "value": "resource"
                      },
                      {
                        "type": "string",
                        "value": "method"
                      }
                    ]
                  },
                  {
                    "type": "string",
                    "value": "GET"
                  }
                ],
                "index": 1
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "data"
                      },
                      {
                        "type": "string",
                        "value": "copilotiq"
                      },
                      {
                        "type": "string",
                        "value": "common"
                      },
                      {
                        "type": "string",
                        "value": "entity"
                      }
                    ]
                  },
                  {
                    "type": "string",
                    "value": "token"
                  }
                ],
                "index": 2
              }
            ]
          }
        ],
        "comments": [
          {
            "Text": "IEF1dGhvcml6YXRpb24gUG9saWN5IGZvciBBUEkgVG9rZW4gR2VuZXJhdGlvbiBhbmQgUmVmcmVzaA==",
            "Location": {
              "file": "copilotiq/tokens.rego",
              "row": 1,
              "col": 1
            }
          },
          {
            "Text": "IENyZWF0ZWQgTS4gTWFzc2VuemlvLCAyMDIyLTA2LTA3",
            "Location": {
              "file": "copilotiq/tokens.rego",
              "row": 2,
              "col": 1
            }
          },
          {
            "Text": "IFVzZXJzIGFyZSBhbGxvd2VkIHRvIHJlcXVlc3QgdGhlaXIgdG9rZW5zIHRvIGJlIHJlZnJlc2hlZC4=",
            "Location": {
              "file": "copilotiq/tokens.rego",
              "row": 7,
              "col": 1
            }
          }
        ]
      }
    },
    {
      "id": "copilotiq/common.rego",
      "raw": "# JWT Authorization Policy\n# Created M. Massenzio, 2021-11-15\n#\n# Common functionality\n\n\npackage copilotiq.common\nimport future.keywords.in\n\n# The JWT carries the username and roles, which will be used\n# to authorize access to the endpoint (`input.resource.path`)\ntoken := t[1] {\n    t := io.jwt.decode(input.api_token)\n}\n\n# We only accept JWT issued by a trusted `iss` claim\nuser := u {\n    token.iss == \"example.issuer\"\n    u = token.sub\n}\n\nroles := r {\n    r = token.roles\n}\n\n# SYSTEM roles (typically, only bots) are allowed to make any\n# API calls, with whatever HTTP Method.\nis_system {\n    some i, \"SYSTEM\" in roles\n}\n\n# Admin users can only create/modify a subset\n# of entities, but is still a powerful role, ASSIGN WITH CARE.\nis_admin {\n    some i, \"ADMIN\" in roles\n}\n\n# Users can only modify self, and entities associated\n# with the users themselves.\n# We assume that the user is valid if it could obtain a valid JWT and\n# has at least one Role.\nis_user {\n    count(roles) \u003e 0\n}\n\nis_manager {\n    some i\n      endswith(roles[i], \"MANAGER\")\n}\n\n# Simplified method to split the Path into a mapping {entity, id, extra, query_args}\n# TODO: Further parse the Query args into a mapping.\nsplit_path(path) = s {\n    t := trim(path, \"/\")\n    q := split(t, \"?\")\n    s := split(q[0], \"/\")\n}\n\n# Split the path segments into their constituents\nsegments = split_path(input.resource.path)\nentity := segments[0]\nentity_id := segments[1]\nextra := segments[2]\n",
      "ast": {
        "package": {
          "path": [
            {
              "type": "var",
              "value": "data"
            },
            {
              "type": "string",
              "value": "copilotiq"
            },
            {
              "type": "string",
              "value": "common"
            }
          ]
        },
        "rules": [
          {
            "head": {
              "name": "token",
              "value": {
                "type": "var",
                "value": "__local14__"
              },
              "assign": true,
              "ref": [
                {
                  "type": "var",
                  "value": "token"
                }
              ]
            },
            "body": [
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "var",
                    "value": "__local18__"
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "input"
                      },
                      {
                        "type": "string",
                        "value": "api_token"
                      }
                    ]
                  }
                ],
                "index": 0,
                "generated": true
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "io"
                      },
                      {
                        "type": "string",
                        "value": "jwt"
                      },
                      {
                        "type": "string",
                        "value": "decode"
                      }
                    ]
                  },
                  {
                    "type": "var",
                    "value": "__local18__"
                  },
                  {
                    "type": "var",
                    "value": "__local8__"
                  }
                ],
                "index": 1,
                "generated": true
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "var",
                    "value": "__local0__"
                  },
                  {
                    "type": "var",
                    "value": "__local8__"
                  }
                ],
                "index": 2
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "var",
                    "value": "__local14__"
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "__local0__"
                      },
                      {
                        "type": "number",
                        "value": 1
                      }
                    ]
                  }
                ],
                "index": 3,
                "generated": true
              }
            ]
          },
          {
            "head": {
              "name": "user",
              "value": {
                "type": "var",
                "value": "u"
              },
              "assign": true,
              "ref": [
                {
                  "type": "var",
                  "value": "user"
                }
              ]
            },
            "body": [
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "data"
                      },
                      {
                        "type": "string",
                        "value": "copilotiq"
                      },
                      {
                        "type": "string",
                        "value": "common"
                      },
                      {
                        "type": "string",
                        "value": "token"
                      },
                      {
                        "type": "string",
                        "value": "iss"
                      }
                    ]
                  },
                  {
                    "type": "string",
                    "value": "example.issuer"
                  }
                ],
                "index": 0
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "var",
                    "value": "u"
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "data"
                      },
                      {
                        "type": "string",
                        "value": "copilotiq"
                      },
                      {
                        "type": "string",
                        "value": "common"
                      },
                      {
                        "type": "string",
                        "value": "token"
                      },
                      {
                        "type": "string",
                        "value": "sub"
                      }
                    ]
                  }
                ],
                "index": 1
              }
            ]
          },
          {
            "head": {
              "name": "roles",
              "value": {
                "type": "var",
                "value": "r"
              },
              "assign": true,
              "ref": [
                {
                  "type": "var",
                  "value": "roles"
                }
              ]
            },
            "body": [
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "var",
                    "value": "r"
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "data"
                      },
                      {
                        "type": "string",
                        "value": "copilotiq"
                      },
                      {
                        "type": "string",
                        "value": "common"
                      },
                      {
                        "type": "string",
                        "value": "token"
                      },
                      {
                        "type": "string",
                        "value": "roles"
                      }
                    ]
                  }
                ],
                "index": 0
              }
            ]
          },
          {
            "head": {
              "name": "is_system",
              "value": {
                "type": "boolean",
                "value": true
              },
              "ref": [
                {
                  "type": "var",
                  "value": "is_system"
                }
              ]
            },
            "body": [
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "string",
                    "value": "SYSTEM"
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "data"
                      },
                      {
                        "type": "string",
                        "value": "copilotiq"
                      },
                      {
                        "type": "string",
                        "value": "common"
                      },
                      {
                        "type": "string",
                        "value": "roles"
                      },
                      {
                        "type": "var",
                        "value": "__local1__"
                      }
                    ]
                  }
                ],
                "index": 0
              }
            ]
          },
          {
            "head": {
              "name": "is_admin",
              "value": {
                "type": "boolean",
                "value": true
              },
              "ref": [
                {
                  "type": "var",
                  "value": "is_admin"
                }
              ]
            },
            "body": [
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "string",
                    "value": "ADMIN"
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "data"
                      },
                      {
                        "type": "string",
                        "value": "copilotiq"
                      },
                      {
                        "type": "string",
                        "value": "common"
                      },
                      {
                        "type": "string",
                        "value": "roles"
                      },
                      {
                        "type": "var",
                        "value": "__local2__"
                      }
                    ]
                  }
                ],
                "index": 0
              }
            ]
          },
          {
            "head": {
              "name": "is_user",
              "value": {
                "type": "boolean",
                "value": true
              },
              "ref": [
                {
                  "type": "var",
                  "value": "is_user"
                }
              ]
            },
            "body": [
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "var",
                    "value": "__local19__"
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "data"
                      },
                      {
                        "type": "string",
                        "value": "copilotiq"
                      },
                      {
                        "type": "string",
                        "value": "common"
                      },
                      {
                        "type": "string",
                        "value": "roles"
                      }
                    ]
                  }
                ],
                "index": 0,
                "generated": true
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "count"
                      }
                    ]
                  },
                  {
                    "type": "var",
                    "value": "__local19__"
                  },
                  {
                    "type": "var",
                    "value": "__local9__"
                  }
                ],
                "index": 1,
                "generated": true
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "gt"
                      }
                    ]
                  },
                  {
                    "type": "var",
                    "value": "__local9__"
                  },
                  {
                    "type": "number",
                    "value": 0
                  }
                ],
                "index": 2
              }
            ]
          },
          {
            "head": {
              "name": "is_manager",
              "value": {
                "type": "boolean",
                "value": true
              },
              "ref": [
                {
                  "type": "var",
                  "value": "is_manager"
                }
              ]
            },
            "body": [
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "var",
                    "value": "__local20__"
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "data"
                      },
                      {
                        "type": "string",
                        "value": "copilotiq"
                      },
                      {
                        "type": "string",
                        "value": "common"
                      },
                      {
                        "type": "string",
                        "value": "roles"
                      },
                      {
                        "type": "var",
                        "value": "__local3__"
                      }
                    ]
                  }
                ],
                "index": 0,
                "generated": true
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "endswith"
                      }
                    ]
                  },
                  {
                    "type": "var",
                    "value": "__local20__"
                  },
                  {
                    "type": "string",
                    "value": "MANAGER"
                  }
                ],
                "index": 1
              }
            ]
          },
          {
            "head": {
              "name": "split_path",
              "args": [
                {
                  "type": "var",
                  "value": "__local4__"
                }
              ],
              "value": {
                "type": "var",
                "value": "__local7__"
              },
              "ref": [
                {
                  "type": "var",
                  "value": "split_path"
                }
              ]
            },
            "body": [
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "trim"
                      }
                    ]
                  },
                  {
                    "type": "var",
                    "value": "__local4__"
                  },
                  {
                    "type": "string",
                    "value": "/"
                  },
                  {
                    "type": "var",
                    "value": "__local10__"
                  }
                ],
                "index": 0,
                "generated": true
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "var",
                    "value": "__local5__"
                  },
                  {
                    "type": "var",
                    "value": "__local10__"
                  }
                ],
                "index": 1
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "split"
                      }
                    ]
                  },
                  {
                    "type": "var",
                    "value": "__local5__"
                  },
                  {
                    "type": "string",
                    "value": "?"
                  },
                  {
                    "type": "var",
                    "value": "__local11__"
                  }
                ],
                "index": 2,
                "generated": true
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "var",
                    "value": "__local6__"
                  },
                  {
                    "type": "var",
                    "value": "__local11__"
                  }
                ],
                "index": 3
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "var",
                    "value": "__local21__"
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "__local6__"
                      },
                      {
                        "type": "number",
                        "value": 0
                      }
                    ]
                  }
                ],
                "index": 4,
                "generated": true
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "split"
                      }
                    ]
                  },
                  {
                    "type": "var",
                    "value": "__local21__"
                  },
                  {
                    "type": "string",
                    "value": "/"
                  },
                  {
                    "type": "var",
                    "value": "__local12__"
                  }
                ],
                "index": 5,
                "generated": true
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "var",
                    "value": "__local7__"
                  },
                  {
                    "type": "var",
                    "value": "__local12__"
                  }
                ],
                "index": 6
              }
            ]
          },
          {
            "head": {
              "name": "segments",
              "value": {
                "type": "var",
                "value": "__local13__"
              },
              "ref": [
                {
                  "type": "var",
                  "value": "segments"
                }
              ]
            },
            "body": [
              {
                "terms": {
                  "type": "boolean",
                  "value": true
                },
                "index": 0
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "var",
                    "value": "__local22__"
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "input"
                      },
                      {
                        "type": "string",
                        "value": "resource"
                      },
                      {
                        "type": "string",
                        "value": "path"
                      }
                    ]
                  }
                ],
                "index": 1,
                "generated": true
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "data"
                      },
                      {
                        "type": "string",
                        "value": "copilotiq"
                      },
                      {
                        "type": "string",
                        "value": "common"
                      },
                      {
                        "type": "string",
                        "value": "split_path"
                      }
                    ]
                  },
                  {
                    "type": "var",
                    "value": "__local22__"
                  },
                  {
                    "type": "var",
                    "value": "__local13__"
                  }
                ],
                "index": 2,
                "generated": true
              }
            ]
          },
          {
            "head": {
              "name": "entity",
              "value": {
                "type": "var",
                "value": "__local15__"
              },
              "assign": true,
              "ref": [
                {
                  "type": "var",
                  "value": "entity"
                }
              ]
            },
            "body": [
              {
                "terms": {
                  "type": "boolean",
                  "value": true
                },
                "index": 0
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "var",
                    "value": "__local15__"
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "data"
                      },
                      {
                        "type": "string",
                        "value": "copilotiq"
                      },
                      {
                        "type": "string",
                        "value": "common"
                      },
                      {
                        "type": "string",
                        "value": "segments"
                      },
                      {
                        "type": "number",
                        "value": 0
                      }
                    ]
                  }
                ],
                "index": 1,
                "generated": true
              }
            ]
          },
          {
            "head": {
              "name": "entity_id",
              "value": {
                "type": "var",
                "value": "__local16__"
              },
              "assign": true,
              "ref": [
                {
                  "type": "var",
                  "value": "entity_id"
                }
              ]
            },
            "body": [
              {
                "terms": {
                  "type": "boolean",
                  "value": true
                },
                "index": 0
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "var",
                    "value": "__local16__"
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "data"
                      },
                      {
                        "type": "string",
                        "value": "copilotiq"
                      },
                      {
                        "type": "string",
                        "value": "common"
                      },
                      {
                        "type": "string",
                        "value": "segments"
                      },
                      {
                        "type": "number",
                        "value": 1
                      }
                    ]
                  }
                ],
                "index": 1,
                "generated": true
              }
            ]
          },
          {
            "head": {
              "name": "extra",
              "value": {
                "type": "var",
                "value": "__local17__"
              },
              "assign": true,
              "ref": [
                {
                  "type": "var",
                  "value": "extra"
                }
              ]
            },
            "body": [
              {
                "terms": {
                  "type": "boolean",
                  "value": true
                },
                "index": 0
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "var",
                    "value": "__local17__"
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "data"
                      },
                      {
                        "type": "string",
                        "value": "copilotiq"
                      },
                      {
                        "type": "string",
                        "value": "common"
                      },
                      {
                        "type": "string",
                        "value": "segments"
                      },
                      {
                        "type": "number",
                        "value": 2
                      }
                    ]
                  }
                ],
                "index": 1,
                "generated": true
              }
            ]
          }
        ],
        "comments": [
          {
            "Text": "IEpXVCBBdXRob3JpemF0aW9uIFBvbGljeQ==",
            "Location": {
              "file": "copilotiq/common.rego",
              "row": 1,
              "col": 1
            }
          },
          {
            "Text": "IENyZWF0ZWQgTS4gTWFzc2VuemlvLCAyMDIxLTExLTE1",
            "Location": {
              "file": "copilotiq/common.rego",
              "row": 2,
              "col": 1
            }
          },
          {
            "Text": "",
            "Location": {
              "file": "copilotiq/common.rego",
              "row": 3,
              "col": 1
            }
          },
          {
            "Text": "IENvbW1vbiBmdW5jdGlvbmFsaXR5",
            "Location": {
              "file": "copilotiq/common.rego",
              "row": 4,
              "col": 1
            }
          },
          {
            "Text": "IFRoZSBKV1QgY2FycmllcyB0aGUgdXNlcm5hbWUgYW5kIHJvbGVzLCB3aGljaCB3aWxsIGJlIHVzZWQ=",
            "Location": {
              "file": "copilotiq/common.rego",
              "row": 10,
              "col": 1
            }
          },
          {
            "Text": "IHRvIGF1dGhvcml6ZSBhY2Nlc3MgdG8gdGhlIGVuZHBvaW50IChgaW5wdXQucmVzb3VyY2UucGF0aGAp",
            "Location": {
              "file": "copilotiq/common.rego",
              "row": 11,
              "col": 1
            }
          },
          {
            "Text": "IFdlIG9ubHkgYWNjZXB0IEpXVCBpc3N1ZWQgYnkgYSB0cnVzdGVkIGBpc3NgIGNsYWlt",
            "Location": {
              "file": "copilotiq/common.rego",
              "row": 16,
              "col": 1
            }
          },
          {
            "Text": "IFNZU1RFTSByb2xlcyAodHlwaWNhbGx5LCBvbmx5IGJvdHMpIGFyZSBhbGxvd2VkIHRvIG1ha2UgYW55",
            "Location": {
              "file": "copilotiq/common.rego",
              "row": 26,
              "col": 1
            }
          },
          {
            "Text": "IEFQSSBjYWxscywgd2l0aCB3aGF0ZXZlciBIVFRQIE1ldGhvZC4=",
            "Location": {
              "file": "copilotiq/common.rego",
              "row": 27,
              "col": 1
            }
          },
          {
            "Text": "IEFkbWluIHVzZXJzIGNhbiBvbmx5IGNyZWF0ZS9tb2RpZnkgYSBzdWJzZXQ=",
            "Location": {
              "file": "copilotiq/common.rego",
              "row": 32,
              "col": 1
            }
          },
          {
            "Text": "IG9mIGVudGl0aWVzLCBidXQgaXMgc3RpbGwgYSBwb3dlcmZ1bCByb2xlLCBBU1NJR04gV0lUSCBDQVJFLg==",
            "Location": {
              "file": "copilotiq/common.rego",
              "row": 33,
              "col": 1
            }
          },
          {
            "Text": "IFVzZXJzIGNhbiBvbmx5IG1vZGlmeSBzZWxmLCBhbmQgZW50aXRpZXMgYXNzb2NpYXRlZA==",
            "Location": {
              "file": "copilotiq/common.rego",
              "row": 38,
              "col": 1
            }
          },
          {
            "Text": "IHdpdGggdGhlIHVzZXJzIHRoZW1zZWx2ZXMu",
            "Location": {
              "file": "copilotiq/common.rego",
              "row": 39,
              "col": 1
            }
          },
          {
            "Text": "IFdlIGFzc3VtZSB0aGF0IHRoZSB1c2VyIGlzIHZhbGlkIGlmIGl0IGNvdWxkIG9idGFpbiBhIHZhbGlkIEpXVCBhbmQ=",
            "Location": {
              "file": "copilotiq/common.rego",
              "row": 40,
              "col": 1
            }
          },
          {
            "Text": "IGhhcyBhdCBsZWFzdCBvbmUgUm9sZS4=",
            "Location": {
              "file": "copilotiq/common.rego",
              "row": 41,
              "col": 1
            }
          },
          {
            "Text": "IFNpbXBsaWZpZWQgbWV0aG9kIHRvIHNwbGl0IHRoZSBQYXRoIGludG8gYSBtYXBwaW5nIHtlbnRpdHksIGlkLCBleHRyYSwgcXVlcnlfYXJnc30=",
            "Location": {
              "file": "copilotiq/common.rego",
              "row": 51,
              "col": 1
            }
          },
          {
            "Text": "IFRPRE86IEZ1cnRoZXIgcGFyc2UgdGhlIFF1ZXJ5IGFyZ3MgaW50byBhIG1hcHBpbmcu",
            "Location": {
              "file": "copilotiq/common.rego",
              "row": 52,
              "col": 1
            }
          },
          {
            "Text": "IFNwbGl0IHRoZSBwYXRoIHNlZ21lbnRzIGludG8gdGhlaXIgY29uc3RpdHVlbnRz",
            "Location": {
              "file": "copilotiq/common.rego",
              "row": 59,
              "col": 1
            }
          }
        ]
      }
    },
    {
      "id": "copilotiq/users.rego",
      "raw": "# JWT Authorization Policy\n# Created M. Massenzio, 2021-11-15\n#\n# This should be loaded to the OPA Policy Server via a PUT request to the /v1/policies endpoint.\n\npackage copilotiq\nimport data.copilotiq.common as c\nimport future.keywords.in\n\ndefault allow = false\n\n# System accounts are allowed to make all API calls.\nallow {\n  c.is_system\n}\n\n# User is allowed to view/modify self but cannot create/delete itself,\n# neither execute extra actions (roles, status, username)\nallow {\n    c.entity == \"users\"\n    c.is_user\n    c.entity_id == c.user\n    not c.extra\n    input.resource.method in [ \"GET\", \"PUT\"]\n}\n\n# Admin is allowed to view/create/delete all users.\nallow {\n    c.entity == \"users\"\n    c.is_admin\n    input.resource.method in [\"GET\", \"DELETE\", \"POST\"]\n}\n\n# Admin is allowed to update users status.\nallow {\n  c.is_admin\n  c.entity == \"users\"\n  c.extra == \"status\"\n  input.resource.method == \"PUT\"\n}\n\n# Admin is allowed to update users roles.\n# See ENG-370\nallow {\n  c.is_admin\n  c.entity == \"users\"\n  c.extra == \"roles\"\n  input.resource.method == \"PUT\"\n}\n\n# Leadership is allowed to view users.\n# See ENG-652\nallow {\n  c.is_leadership\n  c.entity == \"users\"\n  input.resource.method == \"GET\"\n}\n\n# ENG-215: Medical staff are allowed to view patients details.\nallow {\n  c.is_medical_staff\n  c.entity == \"users\"\n  input.resource.method == \"GET\"\n}\n\n# ENG-352: Medical staff are allowed to view patients accounts.\nallow {\n  c.is_medical_staff\n  c.entity == \"accounts\"\n  input.resource.method == \"GET\"\n}\n\n# ENG-352: NPS can create accounts\nallow {\n  c.is_nps\n  c.entity == \"accounts\"\n  input.resource.method == \"POST\"\n}\n\n# ENG-352: NPS can add/update accounts\nallow {\n  c.is_nps\n  c.entity == \"users\"\n  c.extra == \"accounts\"\n  input.resource.method == \"PUT\"\n}\n\n# Admin is allowed all operations on Accounts.\nallow {\n    c.is_admin\n    c.entity == \"accounts\"\n}\n",
      "ast": {
        "package": {
          "path": [
            {
              "type": "var",
              "value": "data"
            },
            {
              "type": "string",
              "value": "copilotiq"
            }
          ]
        },
        "rules": [
          {
            "default": true,
            "head": {
              "name": "allow",
              "value": {
                "type": "boolean",
                "value": false
              },
              "ref": [
                {
                  "type": "var",
                  "value": "allow"
                }
              ]
            },
            "body": [
              {
                "terms": {
                  "type": "boolean",
                  "value": true
                },
                "index": 0
              }
            ]
          },
          {
            "head": {
              "name": "allow",
              "value": {
                "type": "boolean",
                "value": true
              },
              "ref": [
                {
                  "type": "var",
                  "value": "allow"
                }
              ]
            },
            "body": [
              {
                "terms": {
                  "type": "ref",
                  "value": [
                    {
                      "type": "var",
                      "value": "data"
                    },
                    {
                      "type": "string",
                      "value": "copilotiq"
                    },
                    {
                      "type": "string",
                      "value": "common"
                    },
                    {
                      "type": "string",
                      "value": "is_system"
                    }
                  ]
                },
                "index": 0
              }
            ]
          },
          {
            "head": {
              "name": "allow",
              "value": {
                "type": "boolean",
                "value": true
              },
              "ref": [
                {
                  "type": "var",
                  "value": "allow"
                }
              ]
            },
            "body": [
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "data"
                      },
                      {
                        "type": "string",
                        "value": "copilotiq"
                      },
                      {
                        "type": "string",
                        "value": "common"
                      },
                      {
                        "type": "string",
                        "value": "entity"
                      }
                    ]
                  },
                  {
                    "type": "string",
                    "value": "users"
                  }
                ],
                "index": 0
              },
              {
                "terms": {
                  "type": "ref",
                  "value": [
                    {
                      "type": "var",
                      "value": "data"
                    },
                    {
                      "type": "string",
                      "value": "copilotiq"
                    },
                    {
                      "type": "string",
                      "value": "common"
                    },
                    {
                      "type": "string",
                      "value": "is_user"
                    }
                  ]
                },
                "index": 1
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "data"
                      },
                      {
                        "type": "string",
                        "value": "copilotiq"
                      },
                      {
                        "type": "string",
                        "value": "common"
                      },
                      {
                        "type": "string",
                        "value": "entity_id"
                      }
                    ]
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "data"
                      },
                      {
                        "type": "string",
                        "value": "copilotiq"
                      },
                      {
                        "type": "string",
                        "value": "common"
                      },
                      {
                        "type": "string",
                        "value": "user"
                      }
                    ]
                  }
                ],
                "index": 2
              },
              {
                "terms": {
                  "type": "ref",
                  "value": [
                    {
                      "type": "var",
                      "value": "data"
                    },
                    {
                      "type": "string",
                      "value": "copilotiq"
                    },
                    {
                      "type": "string",
                      "value": "common"
                    },
                    {
                      "type": "string",
                      "value": "extra"
                    }
                  ]
                },
                "index": 3,
                "negated": true
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "var",
                    "value": "__local23__"
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "input"
                      },
                      {
                        "type": "string",
                        "value": "resource"
                      },
                      {
                        "type": "string",
                        "value": "method"
                      }
                    ]
                  }
                ],
                "index": 4,
                "generated": true
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "internal"
                      },
                      {
                        "type": "string",
                        "value": "member_2"
                      }
                    ]
                  },
                  {
                    "type": "var",
                    "value": "__local23__"
                  },
                  {
                    "type": "array",
                    "value": [
                      {
                        "type": "string",
                        "value": "GET"
                      },
                      {
                        "type": "string",
                        "value": "PUT"
                      }
                    ]
                  }
                ],
                "index": 5
              }
            ]
          },
          {
            "head": {
              "name": "allow",
              "value": {
                "type": "boolean",
                "value": true
              },
              "ref": [
                {
                  "type": "var",
                  "value": "allow"
                }
              ]
            },
            "body": [
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "data"
                      },
                      {
                        "type": "string",
                        "value": "copilotiq"
                      },
                      {
                        "type": "string",
                        "value": "common"
                      },
                      {
                        "type": "string",
                        "value": "entity"
                      }
                    ]
                  },
                  {
                    "type": "string",
                    "value": "users"
                  }
                ],
                "index": 0
              },
              {
                "terms": {
                  "type": "ref",
                  "value": [
                    {
                      "type": "var",
                      "value": "data"
                    },
                    {
                      "type": "string",
                      "value": "copilotiq"
                    },
                    {
                      "type": "string",
                      "value": "common"
                    },
                    {
                      "type": "string",
                      "value": "is_admin"
                    }
                  ]
                },
                "index": 1
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "var",
                    "value": "__local24__"
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "input"
                      },
                      {
                        "type": "string",
                        "value": "resource"
                      },
                      {
                        "type": "string",
                        "value": "method"
                      }
                    ]
                  }
                ],
                "index": 2,
                "generated": true
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "internal"
                      },
                      {
                        "type": "string",
                        "value": "member_2"
                      }
                    ]
                  },
                  {
                    "type": "var",
                    "value": "__local24__"
                  },
                  {
                    "type": "array",
                    "value": [
                      {
                        "type": "string",
                        "value": "GET"
                      },
                      {
                        "type": "string",
                        "value": "DELETE"
                      },
                      {
                        "type": "string",
                        "value": "POST"
                      }
                    ]
                  }
                ],
                "index": 3
              }
            ]
          },
          {
            "head": {
              "name": "allow",
              "value": {
                "type": "boolean",
                "value": true
              },
              "ref": [
                {
                  "type": "var",
                  "value": "allow"
                }
              ]
            },
            "body": [
              {
                "terms": {
                  "type": "ref",
                  "value": [
                    {
                      "type": "var",
                      "value": "data"
                    },
                    {
                      "type": "string",
                      "value": "copilotiq"
                    },
                    {
                      "type": "string",
                      "value": "common"
                    },
                    {
                      "type": "string",
                      "value": "is_admin"
                    }
                  ]
                },
                "index": 0
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "data"
                      },
                      {
                        "type": "string",
                        "value": "copilotiq"
                      },
                      {
                        "type": "string",
                        "value": "common"
                      },
                      {
                        "type": "string",
                        "value": "entity"
                      }
                    ]
                  },
                  {
                    "type": "string",
                    "value": "users"
                  }
                ],
                "index": 1
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "data"
                      },
                      {
                        "type": "string",
                        "value": "copilotiq"
                      },
                      {
                        "type": "string",
                        "value": "common"
                      },
                      {
                        "type": "string",
                        "value": "extra"
                      }
                    ]
                  },
                  {
                    "type": "string",
                    "value": "status"
                  }
                ],
                "index": 2
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "input"
                      },
                      {
                        "type": "string",
                        "value": "resource"
                      },
                      {
                        "type": "string",
                        "value": "method"
                      }
                    ]
                  },
                  {
                    "type": "string",
                    "value": "PUT"
                  }
                ],
                "index": 3
              }
            ]
          },
          {
            "head": {
              "name": "allow",
              "value": {
                "type": "boolean",
                "value": true
              },
              "ref": [
                {
                  "type": "var",
                  "value": "allow"
                }
              ]
            },
            "body": [
              {
                "terms": {
                  "type": "ref",
                  "value": [
                    {
                      "type": "var",
                      "value": "data"
                    },
                    {
                      "type": "string",
                      "value": "copilotiq"
                    },
                    {
                      "type": "string",
                      "value": "common"
                    },
                    {
                      "type": "string",
                      "value": "is_admin"
                    }
                  ]
                },
                "index": 0
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "data"
                      },
                      {
                        "type": "string",
                        "value": "copilotiq"
                      },
                      {
                        "type": "string",
                        "value": "common"
                      },
                      {
                        "type": "string",
                        "value": "entity"
                      }
                    ]
                  },
                  {
                    "type": "string",
                    "value": "users"
                  }
                ],
                "index": 1
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "data"
                      },
                      {
                        "type": "string",
                        "value": "copilotiq"
                      },
                      {
                        "type": "string",
                        "value": "common"
                      },
                      {
                        "type": "string",
                        "value": "extra"
                      }
                    ]
                  },
                  {
                    "type": "string",
                    "value": "roles"
                  }
                ],
                "index": 2
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "input"
                      },
                      {
                        "type": "string",
                        "value": "resource"
                      },
                      {
                        "type": "string",
                        "value": "method"
                      }
                    ]
                  },
                  {
                    "type": "string",
                    "value": "PUT"
                  }
                ],
                "index": 3
              }
            ]
          },
          {
            "head": {
              "name": "allow",
              "value": {
                "type": "boolean",
                "value": true
              },
              "ref": [
                {
                  "type": "var",
                  "value": "allow"
                }
              ]
            },
            "body": [
              {
                "terms": {
                  "type": "ref",
                  "value": [
                    {
                      "type": "var",
                      "value": "data"
                    },
                    {
                      "type": "string",
                      "value": "copilotiq"
                    },
                    {
                      "type": "string",
                      "value": "common"
                    },
                    {
                      "type": "string",
                      "value": "is_leadership"
                    }
                  ]
                },
                "index": 0
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "data"
                      },
                      {
                        "type": "string",
                        "value": "copilotiq"
                      },
                      {
                        "type": "string",
                        "value": "common"
                      },
                      {
                        "type": "string",
                        "value": "entity"
                      }
                    ]
                  },
                  {
                    "type": "string",
                    "value": "users"
                  }
                ],
                "index": 1
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "input"
                      },
                      {
                        "type": "string",
                        "value": "resource"
                      },
                      {
                        "type": "string",
                        "value": "method"
                      }
                    ]
                  },
                  {
                    "type": "string",
                    "value": "GET"
                  }
                ],
                "index": 2
              }
            ]
          },
          {
            "head": {
              "name": "allow",
              "value": {
                "type": "boolean",
                "value": true
              },
              "ref": [
                {
                  "type": "var",
                  "value": "allow"
                }
              ]
            },
            "body": [
              {
                "terms": {
                  "type": "ref",
                  "value": [
                    {
                      "type": "var",
                      "value": "data"
                    },
                    {
                      "type": "string",
                      "value": "copilotiq"
                    },
                    {
                      "type": "string",
                      "value": "common"
                    },
                    {
                      "type": "string",
                      "value": "is_medical_staff"
                    }
                  ]
                },
                "index": 0
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "data"
                      },
                      {
                        "type": "string",
                        "value": "copilotiq"
                      },
                      {
                        "type": "string",
                        "value": "common"
                      },
                      {
                        "type": "string",
                        "value": "entity"
                      }
                    ]
                  },
                  {
                    "type": "string",
                    "value": "users"
                  }
                ],
                "index": 1
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "input"
                      },
                      {
                        "type": "string",
                        "value": "resource"
                      },
                      {
                        "type": "string",
                        "value": "method"
                      }
                    ]
                  },
                  {
                    "type": "string",
                    "value": "GET"
                  }
                ],
                "index": 2
              }
            ]
          },
          {
            "head": {
              "name": "allow",
              "value": {
                "type": "boolean",
                "value": true
              },
              "ref": [
                {
                  "type": "var",
                  "value": "allow"
                }
              ]
            },
            "body": [
              {
                "terms": {
                  "type": "ref",
                  "value": [
                    {
                      "type": "var",
                      "value": "data"
                    },
                    {
                      "type": "string",
                      "value": "copilotiq"
                    },
                    {
                      "type": "string",
                      "value": "common"
                    },
                    {
                      "type": "string",
                      "value": "is_medical_staff"
                    }
                  ]
                },
                "index": 0
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "data"
                      },
                      {
                        "type": "string",
                        "value": "copilotiq"
                      },
                      {
                        "type": "string",
                        "value": "common"
                      },
                      {
                        "type": "string",
                        "value": "entity"
                      }
                    ]
                  },
                  {
                    "type": "string",
                    "value": "accounts"
                  }
                ],
                "index": 1
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "input"
                      },
                      {
                        "type": "string",
                        "value": "resource"
                      },
                      {
                        "type": "string",
                        "value": "method"
                      }
                    ]
                  },
                  {
                    "type": "string",
                    "value": "GET"
                  }
                ],
                "index": 2
              }
            ]
          },
          {
            "head": {
              "name": "allow",
              "value": {
                "type": "boolean",
                "value": true
              },
              "ref": [
                {
                  "type": "var",
                  "value": "allow"
                }
              ]
            },
            "body": [
              {
                "terms": {
                  "type": "ref",
                  "value": [
                    {
                      "type": "var",
                      "value": "data"
                    },
                    {
                      "type": "string",
                      "value": "copilotiq"
                    },
                    {
                      "type": "string",
                      "value": "common"
                    },
                    {
                      "type": "string",
                      "value": "is_nps"
                    }
                  ]
                },
                "index": 0
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "data"
                      },
                      {
                        "type": "string",
                        "value": "copilotiq"
                      },
                      {
                        "type": "string",
                        "value": "common"
                      },
                      {
                        "type": "string",
                        "value": "entity"
                      }
                    ]
                  },
                  {
                    "type": "string",
                    "value": "accounts"
                  }
                ],
                "index": 1
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "input"
                      },
                      {
                        "type": "string",
                        "value": "resource"
                      },
                      {
                        "type": "string",
                        "value": "method"
                      }
                    ]
                  },
                  {
                    "type": "string",
                    "value": "POST"
                  }
                ],
                "index": 2
              }
            ]
          },
          {
            "head": {
              "name": "allow",
              "value": {
                "type": "boolean",
                "value": true
              },
              "ref": [
                {
                  "type": "var",
                  "value": "allow"
                }
              ]
            },
            "body": [
              {
                "terms": {
                  "type": "ref",
                  "value": [
                    {
                      "type": "var",
                      "value": "data"
                    },
                    {
                      "type": "string",
                      "value": "copilotiq"
                    },
                    {
                      "type": "string",
                      "value": "common"
                    },
                    {
                      "type": "string",
                      "value": "is_nps"
                    }
                  ]
                },
                "index": 0
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "data"
                      },
                      {
                        "type": "string",
                        "value": "copilotiq"
                      },
                      {
                        "type": "string",
                        "value": "common"
                      },
                      {
                        "type": "string",
                        "value": "entity"
                      }
                    ]
                  },
                  {
                    "type": "string",
                    "value": "users"
                  }
                ],
                "index": 1
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "data"
                      },
                      {
                        "type": "string",
                        "value": "copilotiq"
                      },
                      {
                        "type": "string",
                        "value": "common"
                      },
                      {
                        "type": "string",
                        "value": "extra"
                      }
                    ]
                  },
                  {
                    "type": "string",
                    "value": "accounts"
                  }
                ],
                "index": 2
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "input"
                      },
                      {
                        "type": "string",
                        "value": "resource"
                      },
                      {
                        "type": "string",
                        "value": "method"
                      }
                    ]
                  },
                  {
                    "type": "string",
                    "value": "PUT"
                  }
                ],
                "index": 3
              }
            ]
          },
          {
            "head": {
              "name": "allow",
              "value": {
                "type": "boolean",
                "value": true
              },
              "ref": [
                {
                  "type": "var",
                  "value": "allow"
                }
              ]
            },
            "body": [
              {
                "terms": {
                  "type": "ref",
                  "value": [
                    {
                      "type": "var",
                      "value": "data"
                    },
                    {
                      "type": "string",
                      "value": "copilotiq"
                    },
                    {
                      "type": "string",
                      "value": "common"
                    },
                    {
                      "type": "string",
                      "value": "is_admin"
                    }
                  ]
                },
                "index": 0
              },
              {
                "terms": [
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "eq"
                      }
                    ]
                  },
                  {
                    "type": "ref",
                    "value": [
                      {
                        "type": "var",
                        "value": "data"
                      },
                      {
                        "type": "string",
                        "value": "copilotiq"
                      },
                      {
                        "type": "string",
                        "value": "common"
                      },
                      {
                        "type": "string",
                        "value": "entity"
                      }
                    ]
                  },
                  {
                    "type": "string",
                    "value": "accounts"
                  }
                ],
                "index": 1
              }
            ]
          }
        ],
        "comments": [
          {
            "Text": "IEpXVCBBdXRob3JpemF0aW9uIFBvbGljeQ==",
            "Location": {
              "file": "copilotiq/users.rego",
              "row": 1,
              "col": 1
            }
          },
          {
            "Text": "IENyZWF0ZWQgTS4gTWFzc2VuemlvLCAyMDIxLTExLTE1",
            "Location": {
              "file": "copilotiq/users.rego",
              "row": 2,
              "col": 1
            }
          },
          {
            "Text": "",
            "Location": {
              "file": "copilotiq/users.rego",
              "row": 3,
              "col": 1
            }
          },
          {
            "Text": "IFRoaXMgc2hvdWxkIGJlIGxvYWRlZCB0byB0aGUgT1BBIFBvbGljeSBTZXJ2ZXIgdmlhIGEgUFVUIHJlcXVlc3QgdG8gdGhlIC92MS9wb2xpY2llcyBlbmRwb2ludC4=",
            "Location": {
              "file": "copilotiq/users.rego",
              "row": 4,
              "col": 1
            }
          },
          {
            "Text": "IFN5c3RlbSBhY2NvdW50cyBhcmUgYWxsb3dlZCB0byBtYWtlIGFsbCBBUEkgY2FsbHMu",
            "Location": {
              "file": "copilotiq/users.rego",
              "row": 12,
              "col": 1
            }
          },
          {
            "Text": "IFVzZXIgaXMgYWxsb3dlZCB0byB2aWV3L21vZGlmeSBzZWxmIGJ1dCBjYW5ub3QgY3JlYXRlL2RlbGV0ZSBpdHNlbGYs",
            "Location": {
              "file": "copilotiq/users.rego",
              "row": 17,
              "col": 1
            }
          },
          {
            "Text": "IG5laXRoZXIgZXhlY3V0ZSBleHRyYSBhY3Rpb25zIChyb2xlcywgc3RhdHVzLCB1c2VybmFtZSk=",
            "Location": {
              "file": "copilotiq/users.rego",
              "row": 18,
              "col": 1
            }
          },
          {
            "Text": "IEFkbWluIGlzIGFsbG93ZWQgdG8gdmlldy9jcmVhdGUvZGVsZXRlIGFsbCB1c2Vycy4=",
            "Location": {
              "file": "copilotiq/users.rego",
              "row": 27,
              "col": 1
            }
          },
          {
            "Text": "IEFkbWluIGlzIGFsbG93ZWQgdG8gdXBkYXRlIHVzZXJzIHN0YXR1cy4=",
            "Location": {
              "file": "copilotiq/users.rego",
              "row": 34,
              "col": 1
            }
          },
          {
            "Text": "IEFkbWluIGlzIGFsbG93ZWQgdG8gdXBkYXRlIHVzZXJzIHJvbGVzLg==",
            "Location": {
              "file": "copilotiq/users.rego",
              "row": 42,
              "col": 1
            }
          },
          {
            "Text": "IFNlZSBFTkctMzcw",
            "Location": {
              "file": "copilotiq/users.rego",
              "row": 43,
              "col": 1
            }
          },
          {
            "Text": "IExlYWRlcnNoaXAgaXMgYWxsb3dlZCB0byB2aWV3IHVzZXJzLg==",
            "Location": {
              "file": "copilotiq/users.rego",
              "row": 51,
              "col": 1
            }
          },
          {
            "Text": "IFNlZSBFTkctNjUy",
            "Location": {
              "file": "copilotiq/users.rego",
              "row": 52,
              "col": 1
            }
          },
          {
            "Text": "IEVORy0yMTU6IE1lZGljYWwgc3RhZmYgYXJlIGFsbG93ZWQgdG8gdmlldyBwYXRpZW50cyBkZXRhaWxzLg==",
            "Location": {
              "file": "copilotiq/users.rego",
              "row": 59,
              "col": 1
            }
          },
          {
            "Text": "IEVORy0zNTI6IE1lZGljYWwgc3RhZmYgYXJlIGFsbG93ZWQgdG8gdmlldyBwYXRpZW50cyBhY2NvdW50cy4=",
            "Location": {
              "file": "copilotiq/users.rego",
              "row": 66,
              "col": 1
            }
          },
          {
            "Text": "IEVORy0zNTI6IE5QUyBjYW4gY3JlYXRlIGFjY291bnRz",
            "Location": {
              "file": "copilotiq/users.rego",
              "row": 73,
              "col": 1
            }
          },
          {
            "Text": "IEVORy0zNTI6IE5QUyBjYW4gYWRkL3VwZGF0ZSBhY2NvdW50cw==",
            "Location": {
              "file": "copilotiq/users.rego",
              "row": 80,
              "col": 1
            }
          },
          {
            "Text": "IEFkbWluIGlzIGFsbG93ZWQgYWxsIG9wZXJhdGlvbnMgb24gQWNjb3VudHMu",
            "Location": {
              "file": "copilotiq/users.rego",
              "row": 88,
              "col": 1
            }
          }
        ]
      }
    }
  ]
}
